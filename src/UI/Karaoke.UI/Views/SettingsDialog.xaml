<ContentDialog
    x:Class="Karaoke.UI.Views.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:settings="using:Karaoke.UI.ViewModels.Settings"
    mc:Ignorable="d"
    Title="Library Settings"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    Width="1100"
    Height="900">
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="12" Margin="12">
        <TextBlock Text="Configure library roots and drive overrides." />

        <!-- Global Options Section -->
        <StackPanel Spacing="8">
            <TextBlock Text="Global Options" FontWeight="SemiBold" FontSize="16" />

            <!-- Global Keyword Format -->
            <StackPanel Spacing="4">
                <TextBlock Text="Global Keyword Format (Default: artist\song)" FontWeight="SemiBold" />
                <TextBox
                    Text="{Binding GlobalKeywordFormat, Mode=TwoWay}"
                    PlaceholderText="e.g., artist-song-comment" />
                <TextBlock
                    Text="Format: Use keywords separated by hyphens. Supported keywords: artist, song, comment, language, genre. If a keyword appears multiple times, values will be joined with ', '."
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            </StackPanel>

            <!-- Rescan All Checkbox -->
            <CheckBox
                Content="Rescan all folders after saving (overrides individual settings)"
                IsChecked="{Binding RescanAfterSave, Mode=TwoWay}"
                ToolTipService.ToolTip="When checked, all folders will be rescanned regardless of individual folder settings" />
            <TextBlock
                Text="Note: If unchecked, only folders with 'Rescan this folder' checked will be rescanned. Use individual folder settings to save time when only some folders need updating."
                Style="{StaticResource CaptionTextBlockStyle}"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                TextWrapping="Wrap" />

            <!-- Display Options - Currently not implemented in UI, kept for future use -->
            <!--
            <StackPanel Spacing="4" Margin="0,12,0,0">
                <TextBlock Text="Song List Display Options" FontWeight="SemiBold" />
                <TextBlock
                    Text="Choose which information to show in the song list (Song name is always shown)"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                <CheckBox Content="Show Artist" IsChecked="{Binding ShowArtist, Mode=TwoWay}" Margin="0,4,0,0" />
                <CheckBox Content="Show Language" IsChecked="{Binding ShowLanguage, Mode=TwoWay}" />
                <CheckBox Content="Show Genre" IsChecked="{Binding ShowGenre, Mode=TwoWay}" />
                <CheckBox Content="Show Comment" IsChecked="{Binding ShowComment, Mode=TwoWay}" />
                <CheckBox Content="Show Default Track/Channel" IsChecked="{Binding ShowChannel, Mode=TwoWay}" />
                <CheckBox Content="Show Priority" IsChecked="{Binding ShowPriority, Mode=TwoWay}" />
            </StackPanel>
            -->
        </StackPanel>

        <!-- Library Roots Section -->
        <StackPanel Spacing="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Library Folders" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center" />
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="Add Folder" Command="{Binding AddRootCommand}" />
                    <Button Content="Remove Current Tab" Command="{Binding RemoveSelectedRootCommand}" />
                </StackPanel>
            </Grid>

            <TabView
                x:Name="RootsTabView"
                TabItemsSource="{Binding Roots, Mode=OneWay}"
                SelectedItem="{Binding SelectedRoot, Mode=TwoWay}"
                MinHeight="300"
                AddTabButtonClick="OnAddTabButtonClick"
                TabCloseRequested="OnTabCloseRequested">
                <TabView.TabItemTemplate>
                    <DataTemplate x:DataType="settings:LibraryRootItemViewModel">
                        <TabViewItem Header="{x:Bind Name, Mode=OneWay}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="12" Padding="16">
                                    <CheckBox
                                        Content="Rescan this folder when saving"
                                        IsChecked="{x:Bind ShouldRescan, Mode=TwoWay}"
                                        ToolTipService.ToolTip="Check to rescan this folder when saving changes" />

                                    <CheckBox
                                        Content="Volume normalization (analyze loudness with ffmpeg)"
                                        IsChecked="{x:Bind VolumeNormalization, Mode=TwoWay}"
                                        ToolTipService.ToolTip="Perform EBU R128 loudness analysis on all songs in this folder and store gain values for consistent playback volume" />

                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Name" FontWeight="SemiBold" />
                                        <TextBox Text="{x:Bind Name, Mode=TwoWay}" />
                                    </StackPanel>

                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Path" FontWeight="SemiBold" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0" Text="{x:Bind Path, Mode=TwoWay}" Margin="0,0,8,0" />
                                            <Button Grid.Column="1" Content="Browse..." Click="OnBrowseFolderClick" Tag="{x:Bind}" />
                                        </Grid>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <StackPanel Width="120" Spacing="4">
                                            <TextBlock Text="Priority" FontWeight="SemiBold" />
                                            <TextBox Text="{x:Bind DefaultPriority, Mode=TwoWay}" />
                                        </StackPanel>
                                        <StackPanel Width="160" Spacing="4">
                                            <TextBlock Text="Track/Channel" FontWeight="SemiBold" />
                                            <TextBox Text="{x:Bind Instrumental, Mode=TwoWay}" PlaceholderText="0 or 1" />
                                        </StackPanel>
                                        <StackPanel Width="160" Spacing="4">
                                            <TextBlock Text="Drive Override" FontWeight="SemiBold" />
                                            <TextBox Text="{x:Bind DriveOverride, Mode=TwoWay}" PlaceholderText="Optional" />
                                        </StackPanel>
                                    </StackPanel>
                                    <TextBlock
                                        Text="Track/Channel: 0 = first track/left channel (vocals), 1 = second track/right channel (instrumental)"
                                        Style="{StaticResource CaptionTextBlockStyle}"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Keyword Format (Folder-specific)" FontWeight="SemiBold" />
                                        <TextBox
                                            Text="{x:Bind KeywordFormat, Mode=TwoWay}"
                                            PlaceholderText="Overrides global format if set" />
                                        <TextBlock
                                            Text="Leave empty to use global keyword format. Use keywords: artist, song, comment, language, genre"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </TabViewItem>
                    </DataTemplate>
                </TabView.TabItemTemplate>
            </TabView>
        </StackPanel>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
