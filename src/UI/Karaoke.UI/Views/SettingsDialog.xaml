<ContentDialog
    x:Class="Karaoke.UI.Views.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:settings="using:Karaoke.UI.ViewModels.Settings"
    mc:Ignorable="d"
    Title="Library Settings"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    Width="800"
    MaxHeight="600">
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="12" Margin="12">
        <TextBlock Text="Configure library roots and drive overrides." />

        <!-- Global Options Section -->
        <StackPanel Spacing="8">
            <TextBlock Text="Global Options" FontWeight="SemiBold" FontSize="16" />

            <!-- Global Keyword Format -->
            <StackPanel Spacing="4">
                <TextBlock Text="Global Keyword Format (Default)" FontWeight="SemiBold" />
                <TextBox
                    Text="{Binding GlobalKeywordFormat, Mode=TwoWay}"
                    PlaceholderText="e.g., artist-song-comment" />
                <TextBlock
                    Text="Format: Use keywords separated by hyphens. Supported keywords: artist, song, comment, language, genre. If a keyword appears multiple times, values will be joined with ', '."
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            </StackPanel>

            <!-- Rescan All Checkbox -->
            <CheckBox
                Content="Rescan all folders after saving (overrides individual settings)"
                IsChecked="{Binding RescanAfterSave, Mode=TwoWay}"
                ToolTipService.ToolTip="When checked, all folders will be rescanned regardless of individual folder settings" />
            <TextBlock
                Text="Note: If unchecked, only folders with 'Rescan this folder' checked will be rescanned. Use individual folder settings to save time when only some folders need updating."
                Style="{StaticResource CaptionTextBlockStyle}"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                TextWrapping="Wrap" />
        </StackPanel>

        <!-- Library Roots Section -->
        <StackPanel Spacing="8">
            <TextBlock Text="Library Roots" FontWeight="SemiBold" FontSize="16" />
        </StackPanel>

        <ListView
            MinHeight="240"
            MaxHeight="300"
            ItemsSource="{Binding Roots, Mode=OneWay}"
            SelectedItem="{Binding SelectedRoot, Mode=TwoWay}"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="settings:LibraryRootItemViewModel">
                    <StackPanel Spacing="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Name" FontWeight="SemiBold" />
                            <CheckBox 
                                Grid.Column="1" 
                                Content="Rescan this folder" 
                                IsChecked="{x:Bind ShouldRescan, Mode=TwoWay}"
                                ToolTipService.ToolTip="Check to rescan this folder when saving changes" />
                        </Grid>
                        <TextBox Text="{x:Bind Name, Mode=TwoWay}" />
                        <TextBlock Text="Path" FontWeight="SemiBold" Margin="0,8,0,0" />
                        <TextBox Text="{x:Bind Path, Mode=TwoWay}" />
                        <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                            <StackPanel Width="120">
                                <TextBlock Text="Priority" FontWeight="SemiBold" />
                                <TextBox Text="{x:Bind DefaultPriority, Mode=TwoWay}" />
                            </StackPanel>
                            <StackPanel Width="160">
                                <TextBlock Text="Channel" FontWeight="SemiBold" />
                                <TextBox Text="{x:Bind DefaultChannel, Mode=TwoWay}" />
                            </StackPanel>
                            <StackPanel Width="160">
                                <TextBlock Text="Drive Override" FontWeight="SemiBold" />
                                <TextBox Text="{x:Bind DriveOverride, Mode=TwoWay}" PlaceholderText="Optional" />
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Margin="0,8,0,0">
                            <TextBlock Text="Keyword Format (Root-specific)" FontWeight="SemiBold" />
                            <TextBox 
                                Text="{x:Bind KeywordFormat, Mode=TwoWay}" 
                                PlaceholderText="Overrides global format if set" />
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <StackPanel Orientation="Horizontal" Spacing="12">
            <Button Content="Add Root" Command="{Binding AddRootCommand}" />
            <Button Content="Remove Selected" Command="{Binding RemoveSelectedRootCommand}" />
        </StackPanel>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
